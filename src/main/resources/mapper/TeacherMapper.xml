<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.wt.courseselectionsystem.dao.TeacherDao">

    <insert id="insertTeacher">
        insert into teacher(teacher_no, teacher_name, gender)
            value (#{teacher.teacherNo}, #{teacher.teacherName}, #{teacher.gender});
    </insert>

    <update id="updateTeacherInfo">
        update teacher
        <set>
            <if test="teacher.teacherName != null and teacher.teacherName != '' ">
                teacher_name=#{teacher.teacherName},
            </if>
            <if test="teacher.gender != null">
                gender=#{teacher.gender},
            </if>
        </set>
        where teacher_no=#{teacher.teacherNo}
    </update>

    <delete id="delete">
        delete
        from teacher
        where teacher_no = #{teacher.teacherNo};
    </delete>

    <select id="selectByTeacherNo" resultType="com.wt.courseselectionsystem.model.dao.basebean.Teacher">
        select id, teacher_no, teacher_name, gender
        from teacher
        where teacher_no = #{studentno};
    </select>

    <select id="select" resultType="com.wt.courseselectionsystem.model.dao.basebean.Teacher">
        select id, teacher_no, teacher_name, gender from teacher
        <where>
            <if test="@org.springframework.util.StringUtils@hasLength(query.teacherName)">
                teacher_name like concat('%',#{query.teacherName},'%')
            </if>
            <if test="query.gender != null">
                and gender = #{query.gender}
            </if>
            <if test="query.active == 0 or query.active == 1">
                and (select count(*) from account where account_no =
                concat(
                ${@com.wt.courseselectionsystem.common.SystemUtils@
                xmlConstant(@com.wt.courseselectionsystem.common.constant.AccountConstant@TEACHER_PREFIX)}
                ,teacher_no))
                = #{query.active}
            </if>
        </where>
    </select>
    <select id="selectTeacherInfo" resultType="com.wt.courseselectionsystem.model.dao.basebean.Teacher">
        select id, teacher_no, teacher_name, gender from teacher
        <where>
            <if test="@org.springframework.util.StringUtils@hasLength(query.teacherName)">
                teacher_name like concat('%',#{query.teacherName},'%')
            </if>
            <if test="query.gender != null">
                and gender = #{query.gender}
            </if>
            <if test="query.active == 0 or query.active == 1">
                and (select count(*) from account where account_no =
                concat(
                ${@com.wt.courseselectionsystem.common.SystemUtils@
                xmlConstant(@com.wt.courseselectionsystem.common.constant.AccountConstant@TEACHER_PREFIX)}
                ,teacher_no))
                = #{query.active}
            </if>
        </where>
    </select>

    <!--非常丑陋 @author mry5l-->
    <select id="selectDetails" resultType="com.wt.courseselectionsystem.model.vo.response.TeacherDetails">
        select s.student_name,
        s.student_no,
        c.course_name,
        c.credit,
        c.course_hours,
        c.student_number,
        cp.course_plan_year,
        t.teacher_name,
        cs.course_plan_no,
        c.course_no
        from course_plan cp
        join course_selection cs on cp.course_plan_no = cs.course_plan_no
        join course c on c.course_no = cp.course_no
        join student s on cs.student_no = s.student_no
        join teacher t on t.teacher_no = cp.teacher_no
        <where>
            <if test="query.teacherNo != null and query.teacherNo != ''">
                t.teacher_no = #{query.teacherNo}
            </if>
            <if test="query.teacherName != null and query.teacherName != ''">
                and t.teacher_name = #{query.teacherName}
            </if>
            <if test="query.gender != null">
                and t.gender = #{query.gender}
            </if>
        </where>
    </select>


</mapper>
